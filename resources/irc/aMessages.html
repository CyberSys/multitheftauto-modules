<html>
	<head>
		<title>Admin Messages</title>
		<* = exports.ajax:start(getResourceName(getThisResource())) *>
	</head>
	<body>
		<script>
			function read (time,author) {
				getAdminMessage(time,author,
					function (answer) {
						alert(answer);
					}
				);
			}
		</script>
		<table border="1" cellpadding="10">
		<tr>
			<th>Time</th>
			<th>Category</th>
			<th>Author</th>
			<th>Subject</th>
			<th>Read</th>
		</tr>
		<* 
			local i = 0
			local file = xmlLoadFile(":admin/conf/reports.xml")
			if not file then httpWrite("reports.xml file not found!") return end
			while (xmlFindChild(file,"message",i)) do
				node = xmlFindChild(file,"message",i)
				local time = tostring(xmlNodeGetValue(xmlFindChild(node,"time",0)))
				local category = tostring(xmlNodeGetValue(xmlFindChild(node,"category",0)))
				local author = tostring(xmlNodeGetValue(xmlFindChild(node,"author",0)))
				local subject = tostring(xmlNodeGetValue(xmlFindChild(node,"subject",0)))
				
				local Author = '"'..author..'"'
				local Time = '"'..time..'"'
				httpWrite("<tr><td>"..time.."</td><td>"..category.."</td><td>"..author.."</td><td>"..subject.."</td><td><input type='button' value='read' onclick='read("..Author..","..Time..")'></tr>\n")
				
				i = i + 1
			end
		*>
		</table>
	</body>
</html>